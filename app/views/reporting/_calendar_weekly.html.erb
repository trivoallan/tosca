<%
  #We create next/previous weeks links
  last_week = @start_date - 1.week
  link_previous = link_to(StaticPicture::previous_page,
      weekly_reporting_path(:report =>
          { :start_date => last_week.strftime("%Y-%m-%d") }))
  next_week = @start_date + 1.week
  link_next = link_to(StaticPicture::next_page,
    weekly_reporting_path(:report =>
        { :start_date => next_week.strftime("%Y-%m-%d") }))
%>

<h1><%= "#{link_previous}&nbsp;#{@title}&nbsp;#{link_next}" %> <%= StaticPicture::spinner %></h1>


<%= calendar_weekly(@start_date, :start_time => @opening_time,
  :end_time => @closing_time) do |time|
  key = "#{time.day}_#{time.hour}_#{time.min*30/30}"
  result = ""
  if @issues.has_key? key
    if @issues[key].has_key? :new_issues
      result << '['
      res = []
      @issues[key][:new_issues].each do |i|
        res.push link_to_css_issue(i, 'new_issue')
      end
      result << res.join(', ')
      result << ']'
    end

    if @issues[key].has_key? :updated_issues
      result << '['
      res = []
      @issues[key][:updated_issues].each do |i|
        res.push link_to_css_issue(i, 'updated_issue')
      end
      result << res.join(', ')
      result << ']'
    end
  end
  result
end
%>
